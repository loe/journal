<!DOCTYPE html>
<html>
 
<head>
  <title>Rails Development with SSL &mdash; W. Andrew Loe III: Journal</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <meta name="author" content="W. Andrew Loe III">
  <meta name="generator" content="jekyll">
 
  <link rel="stylesheet" href="http://assets.andrewloe.com/css/journal.css" type="text/css">
  <link rel="stylesheet" href="http://assets.andrewloe.com/css/syntax.css" type="text/css">
 
  <link href="http://feeds.andrewloe.com/WALoeIII-Journal" rel="alternate" title="W. Andrew Loe III's Atom Feed" type="application/atom+xml">
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1702281-1']);
    _gaq.push(['_setDomainName', '.andrewloe.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</head>
<body>

<div id="nav">
  <h1><a href="/">W. Andrew Loe III: Journal</a></h1>

  <ul>
    <li><a href="/archive/">Archive</a></li>
    <li><a href="/about/">About</a></li>
    <li><a href="http://feeds.andrewloe.com/WALoeIII-Journal">Feed</a></li>
  </ul>

  <h3>search</h3>
  <form method="get" action="http://www.google.com/search">
    <input type="text" id="search" class="ti" name="q" value="" />
    <input type="hidden" name="q" value="site:journal.andrewloe.com" />
    <input type="submit" value="Search" />
  </form>

  <h3>about me</h3>
  <p>I am a web developer at 
    <a href="http://onehub.com">Onehub</a>. I like sailing, kiteboarding, snowboarding, and computers.</p>

    <h3>more me</h3>

    <ul>
      <li>
        <a href="http://gallery.andrewloe.com/">
          gallery
        </a>
      </li>
      <li>
        <a href="http://github.com/loe">
          github
        </a>
      </li>
      <li>
        <a href="http://twitter.com/WALoeIII">
          Twitter 
        </a>
      </li>
      <li>
        <a href="http://www.facebook.com/WALoeIII">
          Facebook
          </a>
      </li>
      <li>
      <a href="http://www.linkedin.com/in/WALoeIII">
        LinkedIn
        </a>
      </li>
      <li>
        <a href="http://onehub.com/">
          Onehub
          <span>File Transfer and Online Collaboration!</span>
        </a>
      </li>
      <li>
        <a href="mailto:andrew@andrewloe.com">
          Email
        </a>
      </li>
    </ul>

</div>

<div id="content">

  <div class="post">

    <h2>Rails Development with SSL</h2>

    <p class="pubdate">Posted on Thursday, July 17, 2008</p>

    <h2>Big Picture</h2>

<p><a href="http://nginx.net/">Nginx</a> will accept connection on ports 80 (http) and https (443). Under SSL/TLS nginx will negotiate the encryption and proxy any requests that it cannot serve to our trusty <a href="http://mongrel.rubyforge.com/">mongrel</a> running on port 3000. Mongrel doesn&rsquo;t handle encrypted traffic, instead we pass a flag (X_FORWARDED_PROTO) that indicates the request came over SSL.</p>

<h2>Prerequisites</h2>

<p>You will need a functioning <a href="http://macports.com/">Macports</a> installation and a functioning development environment (i.e. you can browse your project at localhost:3000).</p>

<h2>Conventions</h2>

<p><code>$</code> indicates a standard shell prompt.
<code>#</code> indicates the command needs to be run as the root user by assuming root privileges with <code>sudo</code>.</p>

<h3>Install nginx with SSL Support</h3>

<p><code># port install nginx +ssl</code></p>

<h3>Make Your Certs Directory</h3>

<p><code># mkdir -p /opt/local/etc/nginx/certs</code>
<code>$ cd /opt/local/etc/nginx/certs</code></p>

<h3>Make Your Own Certificate</h3>

<p>Follow the prompts but <strong>MAKE SURE TO USE *.example.com AS YOUR Common Name!</strong>
<a href="http://pastie.org/234929">http://pastie.org/234929</a>
<code># openssl req -new -x509 -nodes -days 365 -out server.crt -keyout server.key</code></p>

<h3>Create an nginx Configuration File</h3>

<p>Use <a href="http://pastie.org/234927">http://pastie.org/234927</a> as an example.
Edit out my locations with yours. (i.e. Replace /Users/Andrew/Projects/macchiato with wherever your code lives.)
<code># mate /opt/local/etc/nginx/nginx.conf</code></p>

<h3>Fire Up nginx and Your Mongrel</h3>

<p><code># /opt/local/sbin/nginx</code>
<code>$ script/server</code></p>

<h3>Check Your DNS</h3>

<p><code># mate /etc/hosts to make sure app.example.com points to localhost</code></p>

<h3>Accept Your New Certificate</h3>

<p>Open https://app.example.com/ in Safari. Select Show Certificate and accept it permanently.
In Firefox you will have to manually import your certificate.
Firefox => Preferences => Advanced => Encryption => View Certificates => Authorities => Import => /opt/local/etc/nginx/certs/server.crt => Make sure Trust this CA to identify web sites is checked => Ok.</p>

<h3><a href="http://github.com/rails/ssl_requirement/tree/master">ssl_requirement</a></h3>

<p><a href="http://github.com/rails/ssl_requirement/tree/master">ssl_requirement</a> is the de-facto standard Rails SSL plugin.</p>


</div>

<div class="paginator">
  
    <div class="previous">&larr; <a class="previous" href="/2008/06/27/picnic-in-the-park/" title="Previous post: Picnic In The Park">Picnic In The Park</a></div>
  
  
  
    <div class="next"><a class="next" href="/2008/07/23/columbia-river-gorge-7-19-20/" title="Next post: Columbia River Gorge 7/19-20">Columbia River Gorge 7/19-20</a> &rarr;</div>
  
</div>


</div>
</body>
</html>
